<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2cat Videoboard</title>
    <link rel="stylesheet" href="style.css">
    <script type="importmap">
        {
            "imports": {
                "idb": "https://unpkg.com/idb@7.1.1/build/index.js"
            }
        }
    </script>
</head>
<body>
    <header>
        <h1>2cat Videoboard</h1>
        <p class="subtitle">Welcome to 2cat! (1cat is broken so yeah)</p>
    </header>
    <main id="main-content">
        <section id="normal-boards-section">
            <h2>Boards</h2>
            <div id="normal-boards-container">
                <!-- Normal boards will be listed here -->
            </div>
        </section>

        <section id="video-call-boards-section">
            <h2>Video Call Boards</h2>
            <div id="call-boards-container">
                <!-- Video call boards will be loaded here -->
            </div>
        </section>

        <!-- Content for a selected normal board -->
        <section id="selected-normal-board-view" class="hidden">
            <div class="board-header-controls">
                <button id="back-to-board-list-button">Back to Boards</button>
                <h2 id="current-normal-board-title"></h2>
            </div>
            <section id="upload-section">
                <h3>Create a New Post</h3>
                <form id="post-upload-form">
                    <input type="text" id="username-input" placeholder="Your username (optional)">
                    <input type="file" id="media-file-input" accept="video/*,image/*">
                    <input type="url" id="link-input" placeholder="Add a link (e.g., https://example.com)" pattern="https?://.*" title="Please enter a valid URL starting with http:// or https://">
                    <textarea id="post-comment-input" placeholder="Add a comment..." rows="3"></textarea>
                    <button type="submit">Post</button>
                </form>
            </section>
            <section id="posts-section">
                <h3>Recent Posts</h3>
                <div id="posts-container">
                    <!-- Posts for the selected board will be loaded here -->
                </div>
            </section>
        </section>
    </main>

    <div id="call-interface-overlay" class="hidden">
        <div class="call-header">
            <h2 id="current-call-board-name"></h2>
            <button id="leave-call-button">Leave Call</button>
        </div>
        <div class="video-streams">
            <div class="video-stream-container">
                <h3>Your Stream</h3>
                <video id="local-video" autoplay muted playsinline></video>
            </div>
            <div class="video-stream-container">
                <h3>Remote Stream (Requires Signaling Server)</h3>
                <video id="remote-video" autoplay playsinline></video>
                <p class="signaling-message">For actual multi-person calls, a backend signaling server is required to connect peers.</p>
            </div>
        </div>
        <p class="call-info-message">This is a client-side demonstration of WebRTC capabilities. To connect with other users, a signaling server would facilitate the exchange of connection information (SDP offers/answers and ICE candidates).</p>
    </div>

    <footer class="app-info-footer">
        <p><strong>Note:</strong> AI-powered link checking requires a backend server when deployed online (e.g., at <code>https://2catvb.org/api/check-link</code>) to connect to AI models securely. This client-side code assumes such a backend exists.</p>
        <p>For a full WebRTC video call experience, a signaling server is also required to connect users.</p>
    </footer>

    <script type="module" src="script.js"></script>
</body>
</html>